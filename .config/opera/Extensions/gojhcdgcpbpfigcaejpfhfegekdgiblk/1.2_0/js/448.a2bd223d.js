"use strict";(self["webpackChunkdesktop_wallet"]=self["webpackChunkdesktop_wallet"]||[]).push([[448],{54907:function(t,e,i){i.d(e,{Z:function(){return h}});var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("transition",{attrs:{name:"fade"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.showing,expression:"showing"}],staticClass:"fixed top-0 bottom-0 left-0 right-0 bg-black bg-opacity-40 flex items-center justify-center z-10"},[s("div",{staticClass:"mx-10 my-10 py-7 px-10 rounded-lg bg-modal w-full flex flex-col items-center max-w-screen-sm"},["success"===t.icon?s("img",{staticClass:"w-14 h-14 mb-6",attrs:{src:i(54398)}}):t._e(),t.title?s("div",{staticClass:"mb-4 text-xl font-bold"},[t._v(t._s(t.title))]):t._e(),t.message?s("div",{staticClass:"mb-6 text-center leading-5 text-dark-message text-base opacity-60"},[t._v(" "+t._s(t.message)+" ")]):t._e(),s("primary-button",{staticClass:"mt-2",attrs:{title:t.action},on:{click:t.runActionAndClose}})],1)])])},a=[],n=i(87307),o={components:{PrimaryButton:n.Z},props:{icon:{type:String,default:""}},data(){return{showing:!1,title:"",message:"",action:"",callback:null}},methods:{show(t,e,i,s){this.title=t,this.message=e,this.showing=!0,this.action=i||this.$t("general.dismiss"),this.callback=s},async runActionAndClose(){this.callback&&await this.callback(),this.showing=!1}}},r=o,l=i(1001),c=(0,l.Z)(r,s,a,!1,null,"221c3742",null),h=c.exports},40072:function(t,e,i){i.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("transition",{attrs:{name:"fade"}},[t.showing?i("div",{staticClass:"fade fixed bottom-0 left-0 right-0 top-0 z-50 px-4 bg-black opacity-60",on:{click:t.close}}):t._e()]),i("transition",{attrs:{name:"slide"}},[t.showing?i("div",{staticClass:"fixed bottom-0 left-1/2 -translate-x-1/2 z-50 p-4 rounded-t-3xl bg-modal max-h-screen overflow-y-scroll w-screen max-w-screen-sm"},[t._t("default")],2):t._e()])],1)},a=[],n={data(){return{showing:!1}},methods:{close(){this.$emit("close"),this.showing=!1},show(){this.showing=!0}}},o=n,r=i(1001),l=(0,r.Z)(o,s,a,!1,null,"774449d9",null),c=l.exports},448:function(t,e,i){i.r(e),i.d(e,{default:function(){return L}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"flex flex-col"},[i("top-bar",{attrs:{title:t.$t("general.fioDomains")}}),i("div",{staticClass:"flex flex-col items-center px-4 flex-grow"},[t.isLoading?[i("div",{attrs:{ckass:"flex-grow"}}),i("i",{staticClass:"icon-spinner animate-spin text-emphasis-low"}),i("div",{attrs:{ckass:"flex-grow"}})]:t._e(),t.isLoading||t.domains.length?t._e():i("div",{staticClass:"bg-n2 space-y-2 w-full p-4 rounded-lg"},[t._v(" "+t._s(t.$t("fio.noDomainsFound"))+" ")]),t._l(t.domains,(function(e){return i("div",{key:e.fio_domain,staticClass:"bg-n2 space-y-1 w-full p-4 rounded-lg mb-2"},[i("div",{staticClass:"text-emphasis-high"},[t._v(t._s(e.fio_domain))]),i("div",{staticClass:"text-emphasis-medium text-xs"},[i("div",[t._v(t._s(t.$t("fio.expiration",{date:t.$d(new Date(e.expiration))})))]),i("div",[t._v(" "+t._s(t.$t("fio.public",{status:t.$t(e.public?"general.yes":"general.no")}))+" ")])])])})),i("fio-domain-register-sheet",{ref:"registrationSheet"}),i("alert-dialog",{ref:"errorDialog"}),i("div",{staticClass:"bottom-group"},[i("primary-button",{staticClass:"flex-1",attrs:{loading:t.isLoading,title:t.$t("fio.register.registerButton")},on:{click:t.showRegistrationSheet}})],1)],2)],1)},a=[],n=i(54907),o=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("bottom-sheet",{ref:"sheet"},[i("div",{ref:"test",staticClass:"font-bold text-xl mb-4"},[t._v(t._s(t.$t("fio.register.registerDomain")))]),i("div",{staticClass:"font-bold mb-2"},[t._v(t._s(t.$t("fio.register.name")))]),i("opera-input",{attrs:{type:"test",error:t.error},model:{value:t.domain,callback:function(e){t.domain=e},expression:"domain"}}),i("div",{staticClass:"rounded-lg bg-n3 p-4"},[t._v(t._s(t.$t("general.transactionFee"))+": "+t._s(t.txFee))]),i("div",{staticClass:"flex space-x-4 mt-8"},[i("outlined-button",{staticClass:"flex-1",attrs:{title:t.$t("general.cancel")},on:{click:t.close}}),i("primary-button",{staticClass:"flex-1",attrs:{title:t.$t("general.confirm"),disabled:t.isLoading||t.error||!t.domain.length,loading:t.isLoading},on:{click:t.register}})],1)],1)},r=[],l=(i(21703),i(70794)),c=i(40072),h=i(932),d=i(13655),m=i(87307),u=i(20144),g=i(17731),f=i(4634),p=i(98180),x=i(30668),w=i(98360),b=i(81732),v=i(25108),_=u.Z.extend({components:{PrimaryButton:m.Z,OperaInput:h.Z,OutlinedButton:d.Z,BottomSheet:c.Z},data(){return{callback:null,domain:"",error:null,preparedTx:null,loading:{fee:!1,tx:!1,preparingTx:!1},timers:{fee:null,preparingTx:null}}},computed:{publicKey(){const t=this.$store.getters.accountsByCoinType;return t[w.Dc.FIO]},txFee(){if(!this.preparedTx)return"...";const t=f.ZP.formatNumber(p.Z.withDecimals(this.preparedTx.token.amount,this.preparedTx.token.decimals));return`${t} FIO`},token(){return this.$store.getters.getToken("",w.fr.FIO)},balance(){return this.token?new l.Z(this.token.balance):new l.Z(0)},isLoading(){return Object.values(this.loading).some((t=>!!t))}},watch:{domain(t){this.error=null,t.length<1||!(0,b.qL)(t)?this.error=this.$t("fio.errors.invalidDomainName"):this.tryPrepareTx(t)},preparedTx({token:{amount:t}}){new l.Z(t).isGreaterThan(this.balance)&&(this.error=this.$t("errors.generic.insufficientFunds"))}},methods:{async register(){if(!this.error&&!this.isLoading){this.loading.tx=!0;try{await x.Z.confirmTransaction(this.preparedTx.txId),await this.waitForRegisterToFinish(3e3)}catch(t){v.error(t),this.error=this.$t("errors.generic.somethingWentWrong")}finally{this.loading.tx=!1}}},async waitForRegisterToFinish(t){const e=Date.now();try{const t=await g.Z.getFioDomains(this.publicKey,0,0);if(!t.fio_domains.some((t=>t.fio_domain===this.domain)))throw new Error("FIO domain not found");this.callback&&this.callback(!0),this.close()}catch(i){await new Promise((t=>setTimeout(t,2e3)));const s=Date.now()-e;s>=t?(this.callback&&this.callback(!1),this.close()):await this.waitForRegisterToFinish(t-s)}},close(){this.$refs.sheet.close()},show(t){this.domain="",this.$refs.sheet.show(),this.callback=t},tryPrepareTx(t){this.loading.preparingTx=!0,clearTimeout(this.timers.preparingTx),this.timers.preparingTx=setTimeout((async()=>{try{const e=await g.Z.checkAvailability(t);e.is_registered?(this.error=this.$t("fio.errors.domainNotAvailable"),this.loading.fee=!1,clearTimeout(this.timers.fee)):this.preparedTx=await x.Z.fioEstimateDomainRegistration(this.publicKey,t)}catch(e){v.error(e)}finally{this.loading.preparingTx=!1}}),1e3)}}}),y=_,k=i(1001),$=(0,k.Z)(y,o,r,!1,null,null,null),C=$.exports,T=i(74293),Z=i(25108),F={components:{PrimaryButton:m.Z,TopBar:T.Z,AlertDialog:n.Z,FioDomainRegisterSheet:C},data(){return{loading:{domains:!1},domains:[]}},computed:{isLoading(){return Object.values(this.loading).some((t=>!!t))},publicKey(){const t=this.$store.getters.accountsByCoinType;return t[w.Dc.FIO]}},mounted(){this.fetchFioDomains()},methods:{showRegistrationSheet(){this.$refs.registrationSheet.show((()=>{this.fetchFioDomains()}))},async fetchFioDomains(){this.loading.domains=!0;try{const t=await g.Z.getFioDomains(this.publicKey);this.domains=t.fio_domains}catch(t){404!==t.response.status&&(Z.error(t),this.$refs.errorDialog.show(this.$t("errors.generic.oops"),this.$t("errors.generic.somethingWentWrong")))}finally{this.loading.domains=!1}}}},D=F,B=(0,k.Z)(D,s,a,!1,null,null,null),L=B.exports},54398:function(t,e,i){t.exports=i.p+"img/success.5827329e.svg"}}]);