"use strict";(self["webpackChunkdesktop_wallet"]=self["webpackChunkdesktop_wallet"]||[]).push([[808],{54907:function(t,e,i){i.d(e,{Z:function(){return d}});var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("transition",{attrs:{name:"fade"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:t.showing,expression:"showing"}],staticClass:"fixed top-0 bottom-0 left-0 right-0 bg-black bg-opacity-40 flex items-center justify-center z-10"},[s("div",{staticClass:"mx-10 my-10 py-7 px-10 rounded-lg bg-modal w-full flex flex-col items-center max-w-screen-sm"},["success"===t.icon?s("img",{staticClass:"w-14 h-14 mb-6",attrs:{src:i(54398)}}):t._e(),t.title?s("div",{staticClass:"mb-4 text-xl font-bold"},[t._v(t._s(t.title))]):t._e(),t.message?s("div",{staticClass:"mb-6 text-center leading-5 text-dark-message text-base opacity-60"},[t._v(" "+t._s(t.message)+" ")]):t._e(),s("primary-button",{staticClass:"mt-2",attrs:{title:t.action},on:{click:t.runActionAndClose}})],1)])])},a=[],r=i(87307),n={components:{PrimaryButton:r.Z},props:{icon:{type:String,default:""}},data(){return{showing:!1,title:"",message:"",action:"",callback:null}},methods:{show(t,e,i,s){this.title=t,this.message=e,this.showing=!0,this.action=i||this.$t("general.dismiss"),this.callback=s},async runActionAndClose(){this.callback&&await this.callback(),this.showing=!1}}},o=n,l=i(1001),c=(0,l.Z)(o,s,a,!1,null,"221c3742",null),d=c.exports},33873:function(t,e,i){i.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"flex flex-row h-14 py-2 items-center px-4 active:brightness-75",on:{click:function(e){t.to?t.$router.push(t.to):t.$emit("click")}}},[i("div",{staticClass:"w-4 mr-4"},[t.icon?i("img",{staticClass:"me-4 text-primary-100 text-2xl",attrs:{src:t.icon}}):t._e()]),i("div",[i("div",[t._v(t._s(t.title))]),t.subtitle?i("div",{staticClass:"text-xs",class:t.subtitleClass},[t._v(t._s(t.subtitle))]):t._e()]),i("div",{attrs:{ckass:"flex-grow"}}),t.loading?i("i",{staticClass:"icon-spinner animate-spin"}):t.appendIcon?i("i",{staticClass:"se-4 text-primary-100 text-2xl",class:t.appendIcon}):t._e()])},a=[],r={components:{},props:{title:{type:String,default:""},subtitle:{type:String,default:""},subtitleClass:{type:String,default:""},icon:{type:String,default:""},appendIcon:{type:String,default:""},to:{type:String,default:""},loading:{type:Boolean}}},n=r,o=i(1001),l=(0,o.Z)(n,s,a,!1,null,null,null),c=l.exports},40072:function(t,e,i){i.d(e,{Z:function(){return c}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("transition",{attrs:{name:"fade"}},[t.showing?i("div",{staticClass:"fade fixed bottom-0 left-0 right-0 top-0 z-50 px-4 bg-black opacity-60",on:{click:t.close}}):t._e()]),i("transition",{attrs:{name:"slide"}},[t.showing?i("div",{staticClass:"fixed bottom-0 left-1/2 -translate-x-1/2 z-50 p-4 rounded-t-3xl bg-modal max-h-screen overflow-y-scroll w-screen max-w-screen-sm"},[t._t("default")],2):t._e()])],1)},a=[],r={data(){return{showing:!1}},methods:{close(){this.$emit("close"),this.showing=!1},show(){this.showing=!0}}},n=r,o=i(1001),l=(0,o.Z)(n,s,a,!1,null,"774449d9",null),c=l.exports},3393:function(t,e,i){i.d(e,{Z:function(){return h}});var s=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("bottom-sheet",{ref:"sheet"},[i("div",[t.title?i("div",{staticClass:"font-bold text-xl mb-2"},[t._v(" "+t._s(t.title)+" ")]):t._e(),t._l(t.items,(function(e){return i("div",{key:e.key,on:{click:function(i){return t.itemClicked(e.key)}}},["listItem"===e.type?i("list-item",{staticClass:"-mx-4",attrs:{title:e.title,subtitle:e.subtitle,"subtitle-class":e.subtitleClass,"append-icon":e.appendIcon,loading:e.loading,icon:e.icon},on:{click:function(i){return t.itemClicked(e.key)}}}):t._e(),"divider"===e.type?i("div",{staticClass:"border-t border-positive-10 my-2"}):t._e()],1)}))],2)])},a=[],r=i(40072),n=i(33873),o={components:{BottomSheet:r.Z,ListItem:n.Z},data(){return{title:null,items:null,onItemClicked:null,action:null}},methods:{show(t,e=[],i,s){this.title=t,this.items=e,this.onItemClicked=i,this.action=s,this.$refs.sheet.show()},itemClicked(t){this.onItemClicked&&this.onItemClicked(t),this.$refs.sheet.close()}}},l=o,c=i(1001),d=(0,c.Z)(l,s,a,!1,null,null,null),h=d.exports},94808:function(t,e,i){i.r(e),i.d(e,{default:function(){return C}});var s=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"flex flex-col"},[s("top-bar",{attrs:{title:t.$t("fio.register.title"),"back-override":t.backOverride}}),s("div",{staticClass:"flex flex-col items-center px-4 mt-6 flex-grow"},[s("div",{staticClass:"flex-grow"}),s("div",{staticClass:"flex flex-col items-center mx-6"},[s("img",{staticClass:"w-24 h-24",attrs:{src:i(81741)}}),s("div",{staticClass:"text-emphasis-high text-xl text-center mt-4"},[t._v(" "+t._s(t.$t("fio.register.description"))+" ")])]),s("opera-input",{staticClass:"w-full mt-8",class:{"opacity-0":!!t.loading.register||t.registrationDone},attrs:{dir:"ltr",append:t.useOperaDomain?"@opera":null},model:{value:t.handle,callback:function(e){t.handle=e},expression:"handle"}}),s("div",{staticClass:"flex-grow"}),s("div",{staticClass:"flex-grow"}),t.error?s("div",{staticClass:"text-red mb-4 text-sm"},[t._v(t._s(t.error))]):t._e(),t.useOperaDomain?t._e():s("div",{staticClass:"mb-4 p-4 rounded-lg border w-full border-modal flex justify-between text-xs"},[s("div",{staticClass:"text-emphasis-medium"},[t._v(t._s(t.$t("general.transactionFee")))]),s("div",[t._v(t._s(t.txFee))])]),s("alert-dialog",{ref:"completeDialog",attrs:{icon:"success"}}),s("alert-dialog",{ref:"errorDialog"}),s("list-sheet",{ref:"domainSheet"}),s("primary-button",{staticClass:"w-full my-4",class:{"opacity-0":!!t.loading.register||t.registrationDone},attrs:{disabled:!!t.error||!!t.isLoading||!t.isValidFioHandle,loading:t.isLoading,title:t.$t("fio.register.registerButton")},on:{click:t.register}})],1),t.loading.register?s("spinning-loader",{staticClass:"fixed h-full top-0 right-0 bottom-0 left-0 z-20 bg-background bg-opacity-80"}):t._e()],1)},a=[],r=i(54907),n=i(3393),o=i(932),l=i(87307),c=i(93272),d=i(56258),h=i(74293),u=i(17731),p=i(98180),m=i(30668),g=i(98360),f=i(81732),x=i(25108),v={components:{PrimaryButton:l.Z,TopBar:h.Z,AlertDialog:r.Z,OperaInput:o.Z,ListSheet:n.Z,SpinningLoader:c.Z},data(){return{useOperaDomain:!0,registrationDone:!1,handle:"",error:null,preparedTx:null,loading:{preparingRegistration:!1,register:!1},timers:{preparingRegistration:null},backOverride:this.$route.params?.backOverride,successOverride:this.$route.params?.successOverride}},computed:{isValidFioHandle(){const t=(0,f.GB)(this.handleWithDomain);return t},handleWithDomain(){return this.useOperaDomain?`${this.handle}@opera`:this.handle},freeOperaDomainAvailable(){return"false"===this.$route.query.hasOperaDomain},isLoading(){return Object.values(this.loading).some((t=>!!t))},publicKey(){const t=this.$store.getters.accountsByCoinType;return t[g.Dc.FIO]},balance(){return this.$store.getters.getToken("",g.fr.FIO)?.balance},txFee(){if(!this.preparedTx)return"...";const t=p.Z.withDecimals(this.preparedTx.token.amount,this.preparedTx.token.decimals);return`${t} FIO`}},watch:{handle(){this.tryPrepareRegistration()},preparedTx(t){t.token.amount>this.balance&&(this.error=this.$t("errors.generic.insufficientFunds"))},useOperaDomain(){Object.values(this.timers).forEach((t=>clearTimeout(t))),Object.keys(this.loading).forEach((t=>this.loading[t]=!1)),this.handle=""}},mounted(){this.useOperaDomain=!0,d.Z.sendStatsEvent(d.Z.types.IMPRESSION,"wt_fio_register_entered")},methods:{showDomainSheet(){if(this.isLoading)return;const t=this.useOperaDomain?"icon-checkmark":null,e=this.useOperaDomain?null:"icon-checkmark";this.$refs.domainSheet.show(this.$t("fio.chooseActiveDomain"),[{key:"opera",title:"@opera",subtitle:this.$t("general.free"),subtitleClass:"text-green",appendIcon:t,type:"listItem"},{key:"custom",title:"Custom domain",appendIcon:e,type:"listItem"}],(t=>{this.useOperaDomain="opera"===t}))},tryPrepareRegistration(){this.isValidFioHandle&&(this.loading.preparingRegistration=!0,clearTimeout(this.timers.preparingRegistration),this.timers.preparingRegistration=setTimeout((async()=>{try{this.error=null;const t=this.handleWithDomain,e=0===(await u.Z.checkAvailability(t)).is_registered;e?this.useOperaDomain||(this.preparedTx=await m.Z.fioEstimateHandleRegistration(this.publicKey,t)):this.error=this.$t("fio.errors.handleNotAvailable")}catch(t){}finally{this.loading.preparingRegistration=!1}}),1e3))},async connectWithDefaults(){await this.$store.dispatch("fetchFioConnectableAddresses");const t=this.$store.getters.getFioConnectableAddresses;if(t.length){const e=t.filter((t=>t.default));e.length&&await m.Z.fioAddAddresses(this.publicKey,this.handleWithDomain,e)}},async register(){if(this.isLoading)return;this.loading.register=!0;let t=!1;try{let e;e=this.preparedTx&&!this.useOperaDomain?await m.Z.confirmTransaction(this.preparedTx.txId):await m.Z.fioRegisterOperaHandle(this.publicKey,this.handleWithDomain),e?(await this.waitForRegisterToFinish(3e4),t=!0,this.registrationDone=!0):this.showErrorDialog()}catch(e){this.showErrorDialog()}finally{if(t){try{await this.connectWithDefaults()}catch(i){x.error("Error connecting new FIO address with defaults")}d.Z.sendStatsEvent(d.Z.types.IMPRESSION,"wt_fio_register_completed",{type:this.useOperaDomain?"opera":"custom"})}this.loading.register=!1}},async waitForRegisterToFinish(t){const e=Date.now();try{const t=await u.Z.getAllPublicAddresses(this.handleWithDomain);if(t.public_addresses.length>0)return void this.showCompleteDialog();throw"No public addresses"}catch(i){await new Promise((t=>setTimeout(t,2e3)));const s=Date.now()-e;if(s>=t)return void this.showErrorDialog();await this.waitForRegisterToFinish(t-s)}},showCompleteDialog(){this.$refs.completeDialog.show(this.handleWithDomain,this.$t("fio.register.successTitle"),this.$t("general.ok").toUpperCase(),(()=>{"function"===typeof this.successOverride?this.successOverride():this.$router.replace({name:"FioConnect",query:{handle:this.handleWithDomain}})}))},showErrorDialog(){this.$refs.errorDialog.show(this.$t("errors.generic.oops"),this.$t("errors.generic.somethingWentWrong"))}}},b=v,w=i(1001),y=(0,w.Z)(b,s,a,!1,null,null,null),C=y.exports},81741:function(t,e,i){t.exports=i.p+"img/fio.9ee8d805.svg"},54398:function(t,e,i){t.exports=i.p+"img/success.5827329e.svg"}}]);